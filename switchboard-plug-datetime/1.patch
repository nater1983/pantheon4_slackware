From a90639ed4f185f50d4ae448cd9503203dc24b3f4 Mon Sep 17 00:00:00 2001
From: Bobby Rong <931189261@qq.com>
Date: Mon, 16 Aug 2021 14:57:25 +0800
Subject: [PATCH 774/920] l10n: Correctly setup the locales (#100)

---
 meson.build        | 9 +++++++++
 src/Config.vala.in | 2 ++
 src/Plug.vala      | 3 +++
 src/meson.build    | 1 +
 4 files changed, 15 insertions(+)
 create mode 100644 src/Config.vala.in

diff --git a/meson.build b/meson.build
index d082fa3..f2e9b99 100644
--- a/meson.build
+++ b/meson.build
@@ -24,6 +24,15 @@ if (get_option('regenerate_translation'))
     )
 endif
 
+config_data = configuration_data()
+config_data.set_quoted('LOCALEDIR', join_paths(get_option('prefix'), get_option('localedir')))
+config_data.set_quoted('GETTEXT_PACKAGE', meson.project_name() + '-plug')
+config_file = configure_file(
+    input: 'src/Config.vala.in',
+    output: '@BASENAME@',
+    configuration: config_data
+)
+
 subdir('data')
 subdir('src')
 subdir('po')
diff --git a/src/Config.vala.in b/src/Config.vala.in
new file mode 100644
index 0000000..af62dcf
--- /dev/null
+++ b/src/Config.vala.in
@@ -0,0 +1,2 @@
+public const string GETTEXT_PACKAGE = @GETTEXT_PACKAGE@;
+public const string LOCALEDIR = @LOCALEDIR@;
diff --git a/src/Plug.vala b/src/Plug.vala
index a01104e..e6f8628 100644
--- a/src/Plug.vala
+++ b/src/Plug.vala
@@ -21,6 +21,9 @@ public class DateTime.Plug : Switchboard.Plug {
     private MainView main_view;
 
     public Plug () {
+        GLib.Intl.bindtextdomain (GETTEXT_PACKAGE, LOCALEDIR);
+        GLib.Intl.bind_textdomain_codeset (GETTEXT_PACKAGE, "UTF-8");
+
         var settings = new Gee.TreeMap<string, string?> (null, null);
         settings.set ("time", null);
         settings.set ("date", null);
diff --git a/src/meson.build b/src/meson.build
index 1da722f..a2c31f6 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -14,6 +14,7 @@ switchboard_plugsdir = switchboard_dep.get_pkgconfig_variable('plugsdir', define
 shared_module(
     meson.project_name(),
     plug_files,
+    config_file,
     dependencies: [
         dependency('glib-2.0'),
         dependency('gio-2.0'),
-- 
2.45.2

From 7107ffd25c83bae01b115d673ae954186a919208 Mon Sep 17 00:00:00 2001
From: Vishal Rao <vishalrao@gmail.com>
Date: Thu, 19 May 2022 16:30:29 +0530
Subject: [PATCH 803/920] Fix scroll position of time zone city list. (#101)

* Fix scroll position of time zone city list.

* Revert apparent ineffective row align parameter setting.
---
 src/Widgets/TimeZoneGrid.vala | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/Widgets/TimeZoneGrid.vala b/src/Widgets/TimeZoneGrid.vala
index 4d6ba53..fbdfac3 100644
--- a/src/Widgets/TimeZoneGrid.vala
+++ b/src/Widgets/TimeZoneGrid.vala
@@ -164,7 +164,7 @@ public class DateTime.TimeZoneGrid : Gtk.Grid {
             city_list_store.set (iter, 0, key, 1, value);
             if (current_tz == value) {
                 city_view.get_selection ().select_iter (iter);
-                city_view.scroll_to_cell (city_list_store.get_path (iter), null, false, 0, 0);
+                city_view.scroll_to_cell (city_list_store.get_path (iter), null, true, 0, 0);
             }
         });
 
-- 
2.45.2

From a75b07f82474bce8d222931acf435523678d24b9 Mon Sep 17 00:00:00 2001
From: David Hewitt <davidmhewitt@users.noreply.github.com>
Date: Thu, 16 Mar 2023 18:15:57 +0000
Subject: [PATCH 816/920] Switch to GHCR containers (#110)

---
 .github/workflows/gettext.yml |  2 +-
 .github/workflows/main.yml    | 24 +++++++++++++++++-------
 .github/workflows/release.yml |  4 ++--
 3 files changed, 20 insertions(+), 10 deletions(-)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index c138b0d..eb4863a 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -1,7 +1,7 @@
 name: Gettext Updates
 on:
   push:
-    branches: master
+    branches: [master]
 jobs:
   gettext_template:
     runs-on: ubuntu-latest
diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index 9471468..4b1a2e0 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -1,15 +1,25 @@
 name: CI
 
-on: [push, pull_request]
+on:
+  push:
+    branches: [master]
+  pull_request:
+    types:
+      - opened
+      - reopened
+      - synchronize
 
 jobs:
   build:
-
     runs-on: ubuntu-latest
-    
+
+    strategy:
+      fail-fast: false
+      matrix:
+        version: [stable, unstable, development-target]
     container:
-      image: elementary/docker:unstable
-    
+      image: ghcr.io/elementary/docker:${{ matrix.version }}
+
     steps:
     - uses: actions/checkout@v1
     - name: Install Dependencies
@@ -27,10 +37,10 @@ jobs:
   lint:
 
     runs-on: ubuntu-latest
-    
+
     container:
       image: valalang/lint
-      
+
     steps:
     - uses: actions/checkout@v1
     - name: Lint
diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index 58d6e4b..89c1b8d 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -2,8 +2,8 @@ name: Release
 
 on:
   pull_request:
-    branches: master
-    types: closed
+    branches: [master]
+    types: [closed]
 jobs:
   release:
      runs-on: ubuntu-latest
-- 
2.45.2

From e41815f3658aa1cd101a47c17e73d70e586e6592 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Mon, 3 Oct 2022 14:35:00 -0700
Subject: [PATCH 817/920] Fix Gettext Action (#105)

---
 .github/workflows/gettext.yml | 4 ++--
 .github/workflows/main.yml    | 4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index eb4863a..fd3144b 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -4,10 +4,10 @@ on:
     branches: [master]
 jobs:
   gettext_template:
-    runs-on: ubuntu-latest
+    runs-on: ubuntu-22.04
     steps:
     - uses: actions/checkout@v1
-    - uses: elementary/actions/gettext-template@master
+    - uses: elementary/actions/gettext-template@horus
       env:
         GIT_USER_TOKEN: "${{ secrets.GIT_USER_TOKEN }}"
         GIT_USER_NAME: "elementaryBot"
diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index 4b1a2e0..a23ce10 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -21,7 +21,7 @@ jobs:
       image: ghcr.io/elementary/docker:${{ matrix.version }}
 
     steps:
-    - uses: actions/checkout@v1
+    - uses: actions/checkout@v3
     - name: Install Dependencies
       run: |
         apt update
@@ -42,6 +42,6 @@ jobs:
       image: valalang/lint
 
     steps:
-    - uses: actions/checkout@v1
+    - uses: actions/checkout@v3
     - name: Lint
       run: io.elementary.vala-lint -d .
-- 
2.45.2

From fe47255806865fe35d6bdd93bb9dd49f3668e8aa Mon Sep 17 00:00:00 2001
From: David Hewitt <davidmhewitt@users.noreply.github.com>
Date: Thu, 16 Mar 2023 21:30:41 +0000
Subject: [PATCH 818/920] Create .github/dependabot.yml

---
 .github/dependabot.yml | 6 ++++++
 1 file changed, 6 insertions(+)
 create mode 100644 .github/dependabot.yml

diff --git a/.github/dependabot.yml b/.github/dependabot.yml
new file mode 100644
index 0000000..5ace460
--- /dev/null
+++ b/.github/dependabot.yml
@@ -0,0 +1,6 @@
+version: 2
+updates:
+  - package-ecosystem: "github-actions"
+    directory: "/"
+    schedule:
+      interval: "weekly"
-- 
2.45.2

From 1d946d8633f6d9a48f2ab5c7d08f4fbf6ee337bd Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Thu, 16 Mar 2023 16:49:41 -0700
Subject: [PATCH 819/920] Bump actions/checkout from 1 to 3 (#111)

Bumps [actions/checkout](https://github.com/actions/checkout) from 1 to 3.
- [Release notes](https://github.com/actions/checkout/releases)
- [Changelog](https://github.com/actions/checkout/blob/main/CHANGELOG.md)
- [Commits](https://github.com/actions/checkout/compare/v1...v3)

---
updated-dependencies:
- dependency-name: actions/checkout
  dependency-type: direct:production
  update-type: version-update:semver-major
...

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
---
 .github/workflows/gettext.yml | 2 +-
 .github/workflows/release.yml | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index fd3144b..43a3ea2 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -6,7 +6,7 @@ jobs:
   gettext_template:
     runs-on: ubuntu-22.04
     steps:
-    - uses: actions/checkout@v1
+    - uses: actions/checkout@v3
     - uses: elementary/actions/gettext-template@horus
       env:
         GIT_USER_TOKEN: "${{ secrets.GIT_USER_TOKEN }}"
diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index 89c1b8d..fc7c648 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -9,7 +9,7 @@ jobs:
      runs-on: ubuntu-latest
      if: github.event.pull_request.merged == true && true == contains(join(github.event.pull_request.labels.*.name), 'Release')
      steps:
-     - uses: actions/checkout@v1
+     - uses: actions/checkout@v3
      - uses: elementary/actions/release@master
        env:
          GIT_USER_TOKEN: "${{ secrets.GIT_USER_TOKEN }}"
-- 
2.45.2

From 76cb57791504a1a552e44666533f4d0a59423bb6 Mon Sep 17 00:00:00 2001
From: "dependabot[bot]" <49699333+dependabot[bot]@users.noreply.github.com>
Date: Mon, 11 Sep 2023 14:19:51 -0700
Subject: [PATCH 820/920] Bump actions/checkout from 3 to 4 (#114)

---
 .github/workflows/gettext.yml | 2 +-
 .github/workflows/main.yml    | 4 ++--
 .github/workflows/release.yml | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index 43a3ea2..9bbc721 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -6,7 +6,7 @@ jobs:
   gettext_template:
     runs-on: ubuntu-22.04
     steps:
-    - uses: actions/checkout@v3
+    - uses: actions/checkout@v4
     - uses: elementary/actions/gettext-template@horus
       env:
         GIT_USER_TOKEN: "${{ secrets.GIT_USER_TOKEN }}"
diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index a23ce10..0801778 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -21,7 +21,7 @@ jobs:
       image: ghcr.io/elementary/docker:${{ matrix.version }}
 
     steps:
-    - uses: actions/checkout@v3
+    - uses: actions/checkout@v4
     - name: Install Dependencies
       run: |
         apt update
@@ -42,6 +42,6 @@ jobs:
       image: valalang/lint
 
     steps:
-    - uses: actions/checkout@v3
+    - uses: actions/checkout@v4
     - name: Lint
       run: io.elementary.vala-lint -d .
diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index fc7c648..6d9a340 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -9,7 +9,7 @@ jobs:
      runs-on: ubuntu-latest
      if: github.event.pull_request.merged == true && true == contains(join(github.event.pull_request.labels.*.name), 'Release')
      steps:
-     - uses: actions/checkout@v3
+     - uses: actions/checkout@v4
      - uses: elementary/actions/release@master
        env:
          GIT_USER_TOKEN: "${{ secrets.GIT_USER_TOKEN }}"
-- 
2.45.2

From 660583ad410621ae8f7755edf38d9631f0227f51 Mon Sep 17 00:00:00 2001
From: zenitsudev <owenlegrande@gmail.com>
Date: Thu, 22 Sep 2022 03:08:20 +0800
Subject: [PATCH 821/920] Port to GTK4 (#102)

---
 .github/workflows/gettext.yml                 |   2 +-
 .github/workflows/main.yml                    |   5 +-
 .github/workflows/release.yml                 |   6 +-
 README.md                                     |   9 +-
 ...appdata.xml.in => datetime.appdata.xml.in} |   7 +-
 data/meson.build                              |   4 +-
 meson.build                                   |   4 +-
 ...ot => io.elementary.settings.datetime.pot} |   0
 src/CurrentTimeManager.vala                   |   3 +-
 src/DateTime1.vala                            |   2 +-
 src/MainView.vala                             | 135 +++++++++++-------
 src/Parser.vala                               |   3 +-
 src/Plug.vala                                 |   2 +-
 src/Widgets/TimeZoneGrid.vala                 |  53 +++----
 src/meson.build                               |   7 +-
 15 files changed, 135 insertions(+), 107 deletions(-)
 rename data/{io.elementary.switchboard.datetime.appdata.xml.in => datetime.appdata.xml.in} (88%)
 rename po/{datetime-plug.pot => io.elementary.settings.datetime.pot} (100%)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index 9bbc721..0f10361 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -1,7 +1,7 @@
 name: Gettext Updates
 on:
   push:
-    branches: [master]
+    branches: main
 jobs:
   gettext_template:
     runs-on: ubuntu-22.04
diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index 0801778..f56ba6f 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -1,8 +1,6 @@
 name: CI
 
 on:
-  push:
-    branches: [master]
   pull_request:
     types:
       - opened
@@ -25,13 +23,12 @@ jobs:
     - name: Install Dependencies
       run: |
         apt update
-        apt install -y libgranite-dev libswitchboard-2.0-dev meson valac
+        apt install -y libgranite-7-dev libswitchboard-3-dev libadwaita-1-dev meson valac
     - name: Build
       env:
         DESTDIR: out
       run: |
         meson build
-        ninja -C build
         ninja -C build install
 
   lint:
diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index 6d9a340..997b4dc 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -2,8 +2,8 @@ name: Release
 
 on:
   pull_request:
-    branches: [master]
-    types: [closed]
+    branches: main
+    types: closed
 jobs:
   release:
      runs-on: ubuntu-latest
@@ -16,4 +16,4 @@ jobs:
          GIT_USER_NAME: "elementaryBot"
          GIT_USER_EMAIL: "builds@elementary.io"
        with:
-         release_branch: 'odin'
+         release_branch: 'horus'
diff --git a/README.md b/README.md
index ea93289..b6c2230 100644
--- a/README.md
+++ b/README.md
@@ -1,4 +1,4 @@
-# Switchboard Date & Time Plug
+# Date & Time Settings
 [![Translation status](https://l10n.elementary.io/widgets/switchboard/-/switchboard-plug-datetime/svg-badge.svg)](https://l10n.elementary.io/engage/switchboard/?utm_source=widget)
 
 ![screenshot](data/screenshot.png?raw=true)
@@ -7,8 +7,9 @@
 
 You'll need the following dependencies:
 
-* libgranite-dev >= 5.0
-* libswitchboard-2.0-dev
+* libgranite-7-dev
+* libadwaita-1-dev
+* libswitchboard-3-dev
 * meson
 * valac
 
@@ -20,7 +21,7 @@ Run `meson` to configure the build environment and then `ninja` to build
 
 To install, use `ninja install`
 
-    sudo ninja install
+    ninja install
 
 ## Regenerate the Translation.vala
 
diff --git a/data/io.elementary.switchboard.datetime.appdata.xml.in b/data/datetime.appdata.xml.in
similarity index 88%
rename from data/io.elementary.switchboard.datetime.appdata.xml.in
rename to data/datetime.appdata.xml.in
index 32fece6..a54146f 100644
--- a/data/io.elementary.switchboard.datetime.appdata.xml.in
+++ b/data/datetime.appdata.xml.in
@@ -1,11 +1,10 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <component type="addon">
-  <id>io.elementary.switchboard.datetime</id>
-  <extends>io.elementary.switchboard</extends>
+  <id>io.elementary.settings.datetime</id>
+  <extends>io.elementary.settings</extends>
   <name>Date &amp; Time Settings</name>
   <summary>Configure date, time, and select time zone</summary>
   <icon type="stock">preferences-system-time</icon>
-  <translation type="gettext">datetime-plug</translation>
   <releases>
     <release version="2.2.0" date="2021-07-15" urgency="medium">
       <description>
@@ -39,7 +38,7 @@
   </releases>
   <screenshots>
       <screenshot type="default">
-          <image>https://raw.githubusercontent.com/elementary/switchboard-plug-datetime/master/data/screenshot.png</image>
+          <image>https://raw.githubusercontent.com/elementary/switchboard-plug-datetime/main/data/screenshot.png</image>
       </screenshot>
   </screenshots>
   <url type="homepage">https://elementary.io</url>
diff --git a/data/meson.build b/data/meson.build
index 73da4b0..30caa50 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -1,6 +1,6 @@
 i18n.merge_file(
-    input: 'io.elementary.switchboard.datetime.appdata.xml.in',
-    output: 'io.elementary.switchboard.datetime.appdata.xml',
+    input: 'datetime.appdata.xml.in',
+    output: 'io.elementary.settings.datetime.appdata.xml',
     po_dir: join_paths(meson.source_root (), 'po', 'extra'),
     install_dir: join_paths(datadir, 'metainfo'),
     install: true
diff --git a/meson.build b/meson.build
index f2e9b99..e94e1d8 100644
--- a/meson.build
+++ b/meson.build
@@ -4,7 +4,7 @@ project(
     version: '2.2.0'
 )
 
-gettext_name = meson.project_name() + '-plug'
+gettext_name = 'io.elementary.setings.' + meson.project_name()
 gnome = import('gnome')
 i18n = import('i18n')
 
@@ -26,7 +26,7 @@ endif
 
 config_data = configuration_data()
 config_data.set_quoted('LOCALEDIR', join_paths(get_option('prefix'), get_option('localedir')))
-config_data.set_quoted('GETTEXT_PACKAGE', meson.project_name() + '-plug')
+config_data.set_quoted('GETTEXT_PACKAGE', gettext_name)
 config_file = configure_file(
     input: 'src/Config.vala.in',
     output: '@BASENAME@',
diff --git a/po/datetime-plug.pot b/po/io.elementary.settings.datetime.pot
similarity index 100%
rename from po/datetime-plug.pot
rename to po/io.elementary.settings.datetime.pot
diff --git a/src/CurrentTimeManager.vala b/src/CurrentTimeManager.vala
index ee4d916..95dd564 100644
--- a/src/CurrentTimeManager.vala
+++ b/src/CurrentTimeManager.vala
@@ -1,6 +1,5 @@
-// -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-
 /*-
- * Copyright (c) 2014 Pantheon Developers (http://launchpad.net/switchboard-plug-datetime)
+ * Copyright (c) 2014 elementary, Inc. (https://elementary.io)
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
diff --git a/src/DateTime1.vala b/src/DateTime1.vala
index dc0343a..15704b4 100644
--- a/src/DateTime1.vala
+++ b/src/DateTime1.vala
@@ -1,6 +1,6 @@
 // -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-
 /*-
- * Copyright (c) 2014 Pantheon Developers (http://launchpad.net/switchboard-plug-datetime)
+ * Copyright (c) 2014 elementary, Inc. (https://elementary.io)
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
diff --git a/src/MainView.vala b/src/MainView.vala
index eda64fa..4387034 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -17,13 +17,15 @@
  * Authored by: Corentin Noël <corentin@elementaryos.org>
  */
 
-public class DateTime.MainView : Gtk.ScrolledWindow {
+public class DateTime.MainView : Gtk.Widget {
+    private Gtk.ScrolledWindow main_widget;
     private Gtk.Image auto_time_zone_icon;
     private TimeZoneGrid time_zone_picker;
     private DateTime1 datetime1;
     private CurrentTimeManager ct_manager;
     private GLib.Settings clock_settings;
-    private Granite.Widgets.ModeButton time_format;
+    private Gtk.CheckButton meridiem_time_format;
+    private Gtk.CheckButton military_time_format;
     private Pantheon.AccountsService? pantheon_act = null;
 
     private static GLib.Settings time_zone_settings;
@@ -40,39 +42,32 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
 
     static construct {
         time_zone_settings = new GLib.Settings ("org.gnome.desktop.datetime");
+        set_layout_manager_type (typeof (Gtk.BinLayout));
     }
 
     construct {
-        var network_time_label = new Gtk.Label (_("Network time:")) {
+        var time_format_label = new Gtk.Label (_("Time format:")) {
             halign = Gtk.Align.END
         };
 
-        var network_time_switch = new Gtk.Switch () {
-            halign = Gtk.Align.START,
-            valign = Gtk.Align.CENTER
-        };
-
-        var time_picker = new Granite.Widgets.TimePicker ();
-        var date_picker = new Granite.Widgets.DatePicker ();
+        meridiem_time_format = new Gtk.CheckButton.with_label (_("AM/PM"));
 
-        var time_format_label = new Gtk.Label (_("Time format:")) {
-            halign = Gtk.Align.END
+        military_time_format = new Gtk.CheckButton.with_label (_("24-hour")) {
+            group = meridiem_time_format
         };
 
-        time_format = new Granite.Widgets.ModeButton ();
-        time_format.append_text (_("AM/PM"));
-        time_format.append_text (_("24-hour"));
+        var time_format_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
+        time_format_box.append (meridiem_time_format);
+        time_format_box.append (military_time_format);
 
         var time_zone_label = new Gtk.Label (_("Time zone:")) {
             halign = Gtk.Align.END,
             valign = Gtk.Align.START
         };
 
-        auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic", Gtk.IconSize.BUTTON);
-
-        weak Gtk.StyleContext auto_time_zone_icon_context = auto_time_zone_icon.get_style_context ();
-        auto_time_zone_icon_context.add_class (Granite.STYLE_CLASS_ACCENT);
-        auto_time_zone_icon_context.add_class ("purple");
+        auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic");
+        auto_time_zone_icon.add_css_class (Granite.STYLE_CLASS_ACCENT);
+        auto_time_zone_icon.add_css_class ("purple");
 
         var auto_time_zone_switch_label = new Gtk.Label (_("Based on location:"));
 
@@ -80,20 +75,36 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
             tooltip_text = _("Automatically updates the time zone when activated")
         };
 
-        var auto_time_zone_grid = new Gtk.Grid () {
-            column_spacing = 12,
+        var auto_time_zone_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12) {
             hexpand = true,
             margin_bottom = 12
         };
 
-        auto_time_zone_grid.add (auto_time_zone_icon);
-        auto_time_zone_grid.add (auto_time_zone_switch_label);
-        auto_time_zone_grid.add (auto_time_zone_switch);
+        auto_time_zone_box.append (auto_time_zone_icon);
+        auto_time_zone_box.append (auto_time_zone_switch_label);
+        auto_time_zone_box.append (auto_time_zone_switch);
 
         time_zone_picker = new DateTime.TimeZoneGrid () {
             hexpand = true
         };
-        time_zone_picker.get_style_context ().add_class (Gtk.STYLE_CLASS_FRAME);
+        time_zone_picker.add_css_class ("frame");
+
+        var network_time_label = new Gtk.Label (_("Network time:")) {
+            halign = Gtk.Align.END
+        };
+
+        var network_time_switch = new Gtk.Switch () {
+            halign = Gtk.Align.START,
+            valign = Gtk.Align.CENTER
+        };
+
+        var time_picker = new Granite.TimePicker ();
+        var date_picker = new Granite.DatePicker ();
+
+        var network_time_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
+        network_time_box.append (network_time_switch);
+        network_time_box.append (time_picker);
+        network_time_box.append (date_picker);
 
         var week_number_label = new Gtk.Label (_("Show week numbers:")) {
             halign = Gtk.Align.END
@@ -105,11 +116,14 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
         };
 
         var week_number_info = new Gtk.Label (_("e.g. in Calendar and the Date & Time Panel indicator")) {
-            max_width_chars = 40,
             wrap = true,
             xalign = 0
         };
-        week_number_info.get_style_context ().add_class (Gtk.STYLE_CLASS_DIM_LABEL);
+        week_number_info.add_css_class (Granite.STYLE_CLASS_DIM_LABEL);
+
+        var week_number_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
+        week_number_box.append (week_number_switch);
+        week_number_box.append (week_number_info);
 
         var panel_label = new Gtk.Label (_("Show in Panel:")) {
             halign = Gtk.Align.END,
@@ -120,42 +134,45 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
         var weekday_check = new Gtk.CheckButton.with_label (_("Day of the week"));
         var seconds_check = new Gtk.CheckButton.with_label (_("Seconds"));
 
-        var panel_check_grid = new Gtk.Grid () {
-            column_spacing = 12,
+        var panel_check_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12) {
             margin_top = 6
         };
 
-        panel_check_grid.add (date_check);
-        panel_check_grid.add (weekday_check);
-        panel_check_grid.add (seconds_check);
+        panel_check_box.append (date_check);
+        panel_check_box.append (weekday_check);
+        panel_check_box.append (seconds_check);
 
         var grid = new Gtk.Grid () {
             column_spacing = 12,
             halign = Gtk.Align.CENTER,
             margin_bottom = 24,
             margin_top = 24,
+            margin_start = 24,
+            margin_end = 24,
             row_spacing = 12
         };
 
         grid.attach (time_format_label, 0, 0);
-        grid.attach (time_format, 1, 0, 3);
+        grid.attach (time_format_box, 1, 0, 3);
         grid.attach (time_zone_label, 0, 1);
         grid.attach (time_zone_picker, 1, 1, 3);
-        grid.attach (auto_time_zone_grid, 1, 2, 3);
+        grid.attach (auto_time_zone_box, 1, 2, 3);
         grid.attach (network_time_label, 0, 3);
-        grid.attach (network_time_switch, 1, 3);
-        grid.attach (time_picker, 2, 3);
-        grid.attach (date_picker, 3, 3);
+        grid.attach (network_time_box, 1, 3, 3, 1);
         grid.attach (week_number_label, 0, 4);
-        grid.attach (week_number_switch, 1, 4);
-        grid.attach (week_number_info, 2, 4, 2);
+        grid.attach (week_number_box, 1, 4, 3, 1);
         grid.attach (panel_label, 0, 5);
-        grid.attach (panel_check_grid, 1, 5, 3);
+        grid.attach (panel_check_box, 1, 5, 3);
 
-        hscrollbar_policy = Gtk.PolicyType.NEVER;
-        add (grid);
+        var clamp = new Adw.Clamp () {
+            child = grid
+        };
 
-        show_all ();
+        main_widget = new Gtk.ScrolledWindow () {
+            hscrollbar_policy = Gtk.PolicyType.NEVER,
+            child = clamp
+        };
+        main_widget.set_parent (this);
 
         var source = SettingsSchemaSource.get_default ();
         var schema = source.lookup ("io.elementary.desktop.wingpanel.datetime", true);
@@ -167,7 +184,7 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
             week_number_switch.visible = false;
             week_number_info.visible = false;
             panel_label.visible = false;
-            panel_check_grid.visible = false;
+            panel_check_box.visible = false;
         } else {
             wingpanel_settings = new GLib.Settings ("io.elementary.desktop.wingpanel.datetime");
             wingpanel_settings.bind ("clock-show-date", date_check, "active", SettingsBindFlags.DEFAULT);
@@ -224,8 +241,8 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
         });
 
         clock_settings = new GLib.Settings ("org.gnome.desktop.interface");
-        time_format.mode_changed.connect (() => {
-            unowned string new_format = time_format.selected == 0 ? "12h" : "24h";
+        meridiem_time_format.toggled.connect (() => {
+            unowned string new_format = meridiem_time_format.active == true ? "12h" : "24h";
             clock_settings.set_string ("clock-format", new_format);
 
             if (wingpanel_settings != null) {
@@ -286,22 +303,30 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
                 user_path,
                 GLib.DBusProxyFlags.GET_INVALIDATED_PROPERTIES
             );
-            time_format.set_active (pantheon_act.time_format == "12h" ? 0 : 1);
+
+            // the military_time_format toggle button won't be toggled if
+            // meridiem_time_format is 'not active' when this plug is opened
+
+            if (pantheon_act.time_format == "12h") {
+                meridiem_time_format.active = true;
+            } else {
+                military_time_format.active = true;
+            }
         } catch (Error e) {
             critical (e.message);
             // Connect to the GSettings instead
             clock_settings.changed["clock-format"].connect (() => {
                 if (clock_settings.get_string ("clock-format").contains ("12h")) {
-                    time_format.selected = 0;
+                    meridiem_time_format.active = true;
                 } else {
-                    time_format.selected = 1;
+                    meridiem_time_format.active = false;
                 }
             });
 
             if (clock_settings.get_string ("clock-format").contains ("12h")) {
-                time_format.selected = 0;
+                meridiem_time_format.active = true;
             } else {
-                time_format.selected = 1;
+                meridiem_time_format.active = false;
             }
         }
     }
@@ -329,4 +354,10 @@ public class DateTime.MainView : Gtk.ScrolledWindow {
             offset--;
         }
     }
+
+    ~MainView () {
+        while (this.get_last_child () != null) {
+            this.get_last_child ().unparent ();
+        }
+    }
 }
diff --git a/src/Parser.vala b/src/Parser.vala
index 7c7b82d..844e73b 100644
--- a/src/Parser.vala
+++ b/src/Parser.vala
@@ -1,6 +1,5 @@
-// -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-
 /*-
- * Copyright (c) 2014 Pantheon Developers (http://launchpad.net/switchboard-plug-datetime)
+ * Copyright (c) 2014 elementary, Inc. (https://elementary.io)
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
diff --git a/src/Plug.vala b/src/Plug.vala
index e6f8628..7920042 100644
--- a/src/Plug.vala
+++ b/src/Plug.vala
@@ -28,7 +28,7 @@ public class DateTime.Plug : Switchboard.Plug {
         settings.set ("time", null);
         settings.set ("date", null);
         Object (category: Category.SYSTEM,
-            code_name: "io.elementary.switchboard.datetime",
+            code_name: "io.elementary.settings.datetime",
             display_name: _("Date & Time"),
             description: _("Configure date, time, and select time zone"),
             icon: "preferences-system-time",
diff --git a/src/Widgets/TimeZoneGrid.vala b/src/Widgets/TimeZoneGrid.vala
index fbdfac3..d84fb43 100644
--- a/src/Widgets/TimeZoneGrid.vala
+++ b/src/Widgets/TimeZoneGrid.vala
@@ -1,6 +1,5 @@
-// -*- Mode: vala; indent-tabs-mode: nil; tab-width: 4 -*-
 /*-
- * Copyright (c) 2014 Pantheon Developers (http://launchpad.net/switchboard-plug-datetime)
+ * Copyright (c) 2014 elementary, Inc. (https://elementary.io)
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -18,7 +17,7 @@
  * Authored by: Corentin Noël <corentin@elementaryos.org>
  */
 
-public class DateTime.TimeZoneGrid : Gtk.Grid {
+public class DateTime.TimeZoneGrid : Gtk.Box {
     public signal void request_timezone_change (string tz);
 
     private const string AFRICA = "Africa";
@@ -45,7 +44,6 @@ public class DateTime.TimeZoneGrid : Gtk.Grid {
     }
 
     public TimeZoneGrid () {
-        var main_grid = new Gtk.Grid ();
         continent_list_store = new Gtk.ListStore (2, typeof (string), typeof (string));
         continent_list_store.set_default_sort_func ((model, a, b) => {
             Value value_a;
@@ -76,13 +74,15 @@ public class DateTime.TimeZoneGrid : Gtk.Grid {
         continent_list_store.append (out iter);
         continent_list_store.set (iter, 0, _("Pacific"), 1, PACIFIC);
 
-        continent_view = new Gtk.TreeView.with_model (continent_list_store);
-        continent_view.get_style_context ().add_class ("sidebar");
-        continent_view.headers_visible = false;
+        continent_view = new Gtk.TreeView.with_model (continent_list_store) {
+            headers_visible = false
+        };
+        continent_view.add_css_class ("sidebar");
         continent_view.get_selection ().mode = Gtk.SelectionMode.BROWSE;
 
-        var cellrenderer = new Gtk.CellRendererText ();
-        cellrenderer.xpad = 12;
+        var cellrenderer = new Gtk.CellRendererText () {
+            xpad = 12
+        };
         continent_view.insert_column_with_attributes (-1, null, cellrenderer, "text", 0);
         continent_view.get_selection ().changed.connect (() => {
             Gtk.TreeIter activated_iter;
@@ -106,14 +106,17 @@ public class DateTime.TimeZoneGrid : Gtk.Grid {
         });
 
         city_list_store.set_sort_column_id (Gtk.TREE_SORTABLE_DEFAULT_SORT_COLUMN_ID, Gtk.SortType.ASCENDING);
-        city_view = new Gtk.TreeView.with_model (city_list_store);
-        city_view.headers_visible = false;
-
-        var city_cellrenderer = new Gtk.CellRendererText ();
-        city_cellrenderer.ellipsize_set = true;
-        city_cellrenderer.width_chars = 50;
-        city_cellrenderer.wrap_mode = Pango.WrapMode.WORD_CHAR;
-        city_cellrenderer.ellipsize = Pango.EllipsizeMode.END;
+        city_view = new Gtk.TreeView.with_model (city_list_store) {
+            headers_visible = false,
+            hexpand = true
+        };
+
+        var city_cellrenderer = new Gtk.CellRendererText () {
+            ellipsize_set = true,
+            width_chars = 50,
+            wrap_mode = Pango.WrapMode.WORD_CHAR,
+            ellipsize = Pango.EllipsizeMode.END
+        };
         city_view.insert_column_with_attributes (-1, null, city_cellrenderer, "text", 0);
         city_view.get_selection ().changed.connect (() => {
             if (setting_cities == true)
@@ -128,16 +131,14 @@ public class DateTime.TimeZoneGrid : Gtk.Grid {
             }
         });
 
-        var city_scrolled = new Gtk.ScrolledWindow (null, null);
-        city_scrolled.add (city_view);
-        city_scrolled.set_policy (Gtk.PolicyType.NEVER, Gtk.PolicyType.AUTOMATIC);
+        var city_scrolled = new Gtk.ScrolledWindow () {
+            child = city_view,
+            hscrollbar_policy = Gtk.PolicyType.NEVER,
+            vscrollbar_policy = Gtk.PolicyType.AUTOMATIC
+        };
 
-        main_grid.add (continent_view);
-        main_grid.add (new Gtk.Separator (Gtk.Orientation.VERTICAL));
-        main_grid.add (city_scrolled);
-        main_grid.show_all ();
-
-        add (main_grid);
+        append (continent_view);
+        append (city_scrolled);
     }
 
     public void set_timezone (string tz) {
diff --git a/src/meson.build b/src/meson.build
index a2c31f6..d0626da 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -8,7 +8,7 @@ plug_files = files(
     'Widgets/TimeZoneGrid.vala'
 )
 
-switchboard_dep = dependency('switchboard-2.0')
+switchboard_dep = dependency('switchboard-3')
 switchboard_plugsdir = switchboard_dep.get_pkgconfig_variable('plugsdir', define_variable: ['libdir', libdir])
 
 shared_module(
@@ -19,8 +19,9 @@ shared_module(
         dependency('glib-2.0'),
         dependency('gio-2.0'),
         dependency('gobject-2.0'),
-        dependency('granite', version: '>= 5.0.0'),
-        dependency('gtk+-3.0'),
+        dependency('granite-7'),
+        dependency('gtk4'),
+        dependency('libadwaita-1'),
         meson.get_compiler('vala').find_library('posix'),
         switchboard_dep,
         meson.get_compiler('c').find_library('m', required : false)
-- 
2.45.2

diff --git a/src/MainView.vala b/src/MainView.vala
index 4387034..9c5f428 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -46,6 +46,8 @@ public class DateTime.MainView : Gtk.Widget {
     }
 
     construct {
+        var appearance_header = new Granite.HeaderLabel (_("Appearance"));
+
         var time_format_label = new Gtk.Label (_("Time format:")) {
             halign = Gtk.Align.END
         };
@@ -60,51 +62,67 @@ public class DateTime.MainView : Gtk.Widget {
         time_format_box.append (meridiem_time_format);
         time_format_box.append (military_time_format);
 
-        var time_zone_label = new Gtk.Label (_("Time zone:")) {
-            halign = Gtk.Align.END,
-            valign = Gtk.Align.START
-        };
+        var time_zone_label = new Granite.HeaderLabel (_("Time Zone"));
 
-        auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic");
+        auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic") {
+            pixel_size = 24
+        };
         auto_time_zone_icon.add_css_class (Granite.STYLE_CLASS_ACCENT);
         auto_time_zone_icon.add_css_class ("purple");
 
-        var auto_time_zone_switch_label = new Gtk.Label (_("Based on location:"));
+        var auto_time_zone_label = new Gtk.Label (_("Based on location")) {
+            halign = Gtk.Align.START
+        };
 
-        var auto_time_zone_switch = new Gtk.Switch () {
-            tooltip_text = _("Automatically updates the time zone when activated")
+        var auto_time_zone_hint = new Gtk.Label (_("Automatically updates the time zone when activated")) {
+            halign = Gtk.Align.START,
+            wrap = true
         };
+        auto_time_zone_hint.add_css_class (Granite.STYLE_CLASS_DIM_LABEL);
+        auto_time_zone_hint.add_css_class (Granite.STYLE_CLASS_SMALL_LABEL);
 
-        var auto_time_zone_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12) {
-            hexpand = true,
-            margin_bottom = 12
+        var auto_time_zone_radio = new Gtk.CheckButton ();
+
+        var auto_time_zone_grid = new Gtk.Grid () {
+            column_spacing = 3,
+            margin_start = 3
         };
+        auto_time_zone_grid.attach (auto_time_zone_icon, 0, 0, 1, 2);
+        auto_time_zone_grid.attach (auto_time_zone_label, 1, 0);
+        auto_time_zone_grid.attach (auto_time_zone_hint, 1, 1);
+        auto_time_zone_grid.set_parent (auto_time_zone_radio);
 
-        auto_time_zone_box.append (auto_time_zone_icon);
-        auto_time_zone_box.append (auto_time_zone_switch_label);
-        auto_time_zone_box.append (auto_time_zone_switch);
+        var manual_time_zone_radio = new Gtk.CheckButton () {
+            group = auto_time_zone_radio
+        };
 
         time_zone_picker = new DateTime.TimeZoneGrid () {
-            hexpand = true
+            // hexpand = true,
+            margin_start = 6
         };
         time_zone_picker.add_css_class ("frame");
+        time_zone_picker.set_parent (manual_time_zone_radio);
 
-        var network_time_label = new Gtk.Label (_("Network time:")) {
-            halign = Gtk.Align.END
-        };
+        var date_time_header = new Granite.HeaderLabel (_("Date & Time"));
 
-        var network_time_switch = new Gtk.Switch () {
-            halign = Gtk.Align.START,
-            valign = Gtk.Align.CENTER
+        var network_time_radio = new Gtk.CheckButton.with_label (_("Set automatically"));
+
+        var manual_time_radio = new Gtk.CheckButton () {
+            group = network_time_radio
         };
 
-        var time_picker = new Granite.TimePicker ();
+        var time_picker = new Granite.TimePicker () {
+            hexpand = true
+        };
         var date_picker = new Granite.DatePicker ();
 
-        var network_time_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
-        network_time_box.append (network_time_switch);
-        network_time_box.append (time_picker);
-        network_time_box.append (date_picker);
+        var manual_time_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12) {
+            homogeneous = true,
+            margin_start = 6
+        };
+        manual_time_box.append (time_picker);
+        manual_time_box.append (date_picker);
+        manual_time_box.set_parent (manual_time_radio);
 
         var week_number_label = new Gtk.Label (_("Show week numbers:")) {
             halign = Gtk.Align.END
@@ -126,17 +144,14 @@ public class DateTime.MainView : Gtk.Widget {
         week_number_box.append (week_number_info);
 
         var panel_label = new Gtk.Label (_("Show in Panel:")) {
-            halign = Gtk.Align.END,
-            margin_top = 6
+            halign = Gtk.Align.END
         };
 
         var date_check = new Gtk.CheckButton.with_label (_("Date"));
         var weekday_check = new Gtk.CheckButton.with_label (_("Day of the week"));
         var seconds_check = new Gtk.CheckButton.with_label (_("Seconds"));
 
-        var panel_check_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12) {
-            margin_top = 6
-        };
+        var panel_check_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
 
         panel_check_box.append (date_check);
         panel_check_box.append (weekday_check);
@@ -144,25 +159,25 @@ public class DateTime.MainView : Gtk.Widget {
 
         var grid = new Gtk.Grid () {
             column_spacing = 12,
-            halign = Gtk.Align.CENTER,
             margin_bottom = 24,
             margin_top = 24,
-            margin_start = 24,
-            margin_end = 24,
+            margin_start = 12,
+            margin_end = 12,
             row_spacing = 12
         };
-
-        grid.attach (time_format_label, 0, 0);
-        grid.attach (time_format_box, 1, 0, 3);
-        grid.attach (time_zone_label, 0, 1);
-        grid.attach (time_zone_picker, 1, 1, 3);
-        grid.attach (auto_time_zone_box, 1, 2, 3);
-        grid.attach (network_time_label, 0, 3);
-        grid.attach (network_time_box, 1, 3, 3, 1);
-        grid.attach (week_number_label, 0, 4);
-        grid.attach (week_number_box, 1, 4, 3, 1);
-        grid.attach (panel_label, 0, 5);
-        grid.attach (panel_check_box, 1, 5, 3);
+        grid.attach (appearance_header, 0, 0, 2);
+        grid.attach (time_format_label, 0, 1);
+        grid.attach (time_format_box, 1, 1);
+        grid.attach (panel_label, 0, 2);
+        grid.attach (panel_check_box, 1, 2);
+        grid.attach (week_number_label, 0, 3);
+        grid.attach (week_number_box, 1, 3);
+        grid.attach (time_zone_label, 0, 4, 2);
+        grid.attach (auto_time_zone_radio, 0, 5, 2);
+        grid.attach (manual_time_zone_radio, 0, 6, 2);
+        grid.attach (date_time_header, 0, 7, 2);
+        grid.attach (network_time_radio, 0, 8, 2);
+        grid.attach (manual_time_radio, 0, 9, 2);
 
         var clamp = new Adw.Clamp () {
             child = grid
@@ -258,32 +273,33 @@ public class DateTime.MainView : Gtk.Widget {
 
         setup_time_format.begin ();
 
-        network_time_switch.notify["active"].connect (() => {
-            bool active = network_time_switch.active;
-            time_picker.sensitive = !active;
-            date_picker.sensitive = !active;
-            try {
-                datetime1.SetNTP (active, true);
-            } catch (Error e) {
-                critical (e.message);
-            }
-            ct_manager.datetime_has_changed ();
-        });
-
         try {
             datetime1 = Bus.get_proxy_sync (BusType.SYSTEM, "org.freedesktop.timedate1", "/org/freedesktop/timedate1");
+
+            if (datetime1.CanNTP == false) {
+                network_time_radio.sensitive = false;
+            } else if (datetime1.NTP) {
+                network_time_radio.active = true;
+            }
         } catch (IOError e) {
             critical (e.message);
         }
 
-        if (datetime1.CanNTP == false) {
-            network_time_switch.sensitive = false;
-        }
+        network_time_radio.toggled.connect (() => {
+            try {
+                datetime1.SetNTP (network_time_radio.active, true);
+                ct_manager.datetime_has_changed ();
+            } catch (Error e) {
+                manual_time_radio.activate ();
+                critical (e.message);
+            }
+        });
 
-        network_time_switch.active = datetime1.NTP;
         change_tz (datetime1.Timezone);
 
-        time_zone_settings.bind ("automatic-timezone", auto_time_zone_switch, "active", SettingsBindFlags.DEFAULT);
+        network_time_radio.bind_property ("active", manual_time_box, "sensitive", BindingFlags.INVERT_BOOLEAN | BindingFlags.SYNC_CREATE);
+
+        time_zone_settings.bind ("automatic-timezone", auto_time_zone_radio, "active", SettingsBindFlags.DEFAULT);
         time_zone_settings.bind ("automatic-timezone", time_zone_picker, "sensitive", SettingsBindFlags.INVERT_BOOLEAN);
         time_zone_settings.bind ("automatic-timezone", this, "automatic-timezone", SettingsBindFlags.GET);
     }
-- 
2.45.2

From b62d7917f1c1a58be7dadf8df4b4ba21a9989201 Mon Sep 17 00:00:00 2001
From: David Hewitt <davidmhewitt@users.noreply.github.com>
Date: Thu, 16 Mar 2023 18:16:01 +0000
Subject: [PATCH 845/920] Switch to GHCR containers (#109)

---
 .github/workflows/gettext.yml | 2 +-
 .github/workflows/main.yml    | 2 ++
 .github/workflows/release.yml | 4 ++--
 3 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/.github/workflows/gettext.yml b/.github/workflows/gettext.yml
index 0f10361..ee7380b 100644
--- a/.github/workflows/gettext.yml
+++ b/.github/workflows/gettext.yml
@@ -1,7 +1,7 @@
 name: Gettext Updates
 on:
   push:
-    branches: main
+    branches: [main]
 jobs:
   gettext_template:
     runs-on: ubuntu-22.04
diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index f56ba6f..1578709 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -1,6 +1,8 @@
 name: CI
 
 on:
+  push:
+    branches: [main]
   pull_request:
     types:
       - opened
diff --git a/.github/workflows/release.yml b/.github/workflows/release.yml
index 997b4dc..015b072 100644
--- a/.github/workflows/release.yml
+++ b/.github/workflows/release.yml
@@ -2,8 +2,8 @@ name: Release
 
 on:
   pull_request:
-    branches: main
-    types: closed
+    branches: [main]
+    types: [closed]
 jobs:
   release:
      runs-on: ubuntu-latest
-- 
2.45.2

From 696ea4ffc93eca3b3c6ec0710c3600783ba38707 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Thu, 12 Oct 2023 22:20:55 -0700
Subject: [PATCH 855/920] Update main.yml

---
 .github/workflows/main.yml | 2 --
 1 file changed, 2 deletions(-)

diff --git a/.github/workflows/main.yml b/.github/workflows/main.yml
index 1578709..f56ba6f 100644
--- a/.github/workflows/main.yml
+++ b/.github/workflows/main.yml
@@ -1,8 +1,6 @@
 name: CI
 
 on:
-  push:
-    branches: [main]
   pull_request:
     types:
       - opened
-- 
2.45.2

From fd331420382a1635fd6323186787a101f9f67998 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Thu, 12 Oct 2023 22:22:18 -0700
Subject: [PATCH 856/920] Meson: Fix typo

---
 meson.build | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/meson.build b/meson.build
index e94e1d8..e9a1fca 100644
--- a/meson.build
+++ b/meson.build
@@ -4,7 +4,7 @@ project(
     version: '2.2.0'
 )
 
-gettext_name = 'io.elementary.setings.' + meson.project_name()
+gettext_name = 'io.elementary.settings.' + meson.project_name()
 gnome = import('gnome')
 i18n = import('i18n')
 
-- 
2.45.2

From 3871f339614879b66d85a6aadc599d6bf851e03a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Thu, 12 Oct 2023 22:25:08 -0700
Subject: [PATCH 857/920] Update POTFILES

---
 po/extra/POTFILES | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/po/extra/POTFILES b/po/extra/POTFILES
index 3987d65..8d31372 100644
--- a/po/extra/POTFILES
+++ b/po/extra/POTFILES
@@ -1 +1 @@
-data/io.elementary.switchboard.datetime.appdata.xml.in
+data/datetime.appdata.xml.in
-- 
2.45.2

From 0fc3083807b7d980868adfabf394c479dd541f25 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Wed, 7 Feb 2024 04:13:24 -0800
Subject: [PATCH 877/920] Use Switchboard.SettingsPage (#116)

---
 src/MainView.vala | 31 +++++++++----------------------
 1 file changed, 9 insertions(+), 22 deletions(-)

diff --git a/src/MainView.vala b/src/MainView.vala
index 9c5f428..24985f2 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -17,8 +17,7 @@
  * Authored by: Corentin Noël <corentin@elementaryos.org>
  */
 
-public class DateTime.MainView : Gtk.Widget {
-    private Gtk.ScrolledWindow main_widget;
+public class DateTime.MainView : Switchboard.SettingsPage {
     private Gtk.Image auto_time_zone_icon;
     private TimeZoneGrid time_zone_picker;
     private DateTime1 datetime1;
@@ -40,9 +39,15 @@ public class DateTime.MainView : Gtk.Widget {
         }
     }
 
+    public MainView () {
+        Object (
+            icon: new ThemedIcon ("preferences-system-time"),
+            title: _("Date & Time")
+        );
+    }
+
     static construct {
         time_zone_settings = new GLib.Settings ("org.gnome.desktop.datetime");
-        set_layout_manager_type (typeof (Gtk.BinLayout));
     }
 
     construct {
@@ -159,10 +164,6 @@ public class DateTime.MainView : Gtk.Widget {
 
         var grid = new Gtk.Grid () {
             column_spacing = 12,
-            margin_bottom = 24,
-            margin_top = 24,
-            margin_start = 12,
-            margin_end = 12,
             row_spacing = 12
         };
         grid.attach (appearance_header, 0, 0, 2);
@@ -179,15 +180,7 @@ public class DateTime.MainView : Gtk.Widget {
         grid.attach (network_time_radio, 0, 8, 2);
         grid.attach (manual_time_radio, 0, 9, 2);
 
-        var clamp = new Adw.Clamp () {
-            child = grid
-        };
-
-        main_widget = new Gtk.ScrolledWindow () {
-            hscrollbar_policy = Gtk.PolicyType.NEVER,
-            child = clamp
-        };
-        main_widget.set_parent (this);
+        child = grid;
 
         var source = SettingsSchemaSource.get_default ();
         var schema = source.lookup ("io.elementary.desktop.wingpanel.datetime", true);
@@ -370,10 +363,4 @@ public class DateTime.MainView : Gtk.Widget {
             offset--;
         }
     }
-
-    ~MainView () {
-        while (this.get_last_child () != null) {
-            this.get_last_child ().unparent ();
-        }
-    }
 }
-- 
2.45.2

From e4da0b1c95d1da3a8309ae94d98864e1c26355d5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Thu, 8 Feb 2024 14:51:12 -0800
Subject: [PATCH 881/920] MainView: use HeaderLabel for week numbers (#117)

* MainView: use HeaderLabel for week numbers

* Match search case
---
 src/MainView.vala | 24 ++++++++----------------
 src/Plug.vala     |  2 +-
 2 files changed, 9 insertions(+), 17 deletions(-)

diff --git a/src/MainView.vala b/src/MainView.vala
index 24985f2..c56b1ae 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -129,24 +129,19 @@ public class DateTime.MainView : Switchboard.SettingsPage {
         manual_time_box.append (date_picker);
         manual_time_box.set_parent (manual_time_radio);
 
-        var week_number_label = new Gtk.Label (_("Show week numbers:")) {
-            halign = Gtk.Align.END
-        };
-
         var week_number_switch = new Gtk.Switch () {
-            halign = Gtk.Align.START,
-            valign = Gtk.Align.CENTER
+            valign = CENTER
         };
 
-        var week_number_info = new Gtk.Label (_("e.g. in Calendar and the Date & Time Panel indicator")) {
-            wrap = true,
-            xalign = 0
+        var week_number_label = new Granite.HeaderLabel (_("Show Week Numbers")) {
+            hexpand = true,
+            mnemonic_widget = week_number_switch,
+            secondary_text = _("e.g. in Calendar and the Date & Time Panel indicator")
         };
-        week_number_info.add_css_class (Granite.STYLE_CLASS_DIM_LABEL);
 
         var week_number_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
+        week_number_box.append (week_number_label);
         week_number_box.append (week_number_switch);
-        week_number_box.append (week_number_info);
 
         var panel_label = new Gtk.Label (_("Show in Panel:")) {
             halign = Gtk.Align.END
@@ -171,8 +166,7 @@ public class DateTime.MainView : Switchboard.SettingsPage {
         grid.attach (time_format_box, 1, 1);
         grid.attach (panel_label, 0, 2);
         grid.attach (panel_check_box, 1, 2);
-        grid.attach (week_number_label, 0, 3);
-        grid.attach (week_number_box, 1, 3);
+        grid.attach (week_number_box, 0, 3, 2);
         grid.attach (time_zone_label, 0, 4, 2);
         grid.attach (auto_time_zone_radio, 0, 5, 2);
         grid.attach (manual_time_zone_radio, 0, 6, 2);
@@ -188,9 +182,7 @@ public class DateTime.MainView : Switchboard.SettingsPage {
         GLib.Settings wingpanel_settings = null;
 
         if (schema == null) {
-            week_number_label.visible = false;
-            week_number_switch.visible = false;
-            week_number_info.visible = false;
+            grid.remove (week_number_box);
             panel_label.visible = false;
             panel_check_box.visible = false;
         } else {
diff --git a/src/Plug.vala b/src/Plug.vala
index 7920042..07ddb38 100644
--- a/src/Plug.vala
+++ b/src/Plug.vala
@@ -58,7 +58,7 @@ public class DateTime.Plug : Switchboard.Plug {
         search_results.set ("%s → %s".printf (display_name, _("Time Format")), "");
         search_results.set ("%s → %s".printf (display_name, _("Time Zone")), "");
         search_results.set ("%s → %s".printf (display_name, _("Network Time")), "");
-        search_results.set ("%s → %s".printf (display_name, _("Show week numbers")), "");
+        search_results.set ("%s → %s".printf (display_name, _("Show Week Numbers")), "");
         return search_results;
     }
 }
-- 
2.45.2

From 833674b0e55f83729e9fc4b529e54ff624769b7e Mon Sep 17 00:00:00 2001
From: Vishal Rao <vishalrao@gmail.com>
Date: Sun, 11 Feb 2024 01:38:48 +0530
Subject: [PATCH 893/920] Fix initial timezone radio button state (#118)

---
 src/MainView.vala | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/MainView.vala b/src/MainView.vala
index c56b1ae..54099e6 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -283,6 +283,7 @@ public class DateTime.MainView : Switchboard.SettingsPage {
         change_tz (datetime1.Timezone);
 
         network_time_radio.bind_property ("active", manual_time_box, "sensitive", BindingFlags.INVERT_BOOLEAN | BindingFlags.SYNC_CREATE);
+        auto_time_zone_radio.bind_property ("active", manual_time_zone_radio, "active", BindingFlags.INVERT_BOOLEAN | BindingFlags.SYNC_CREATE);
 
         time_zone_settings.bind ("automatic-timezone", auto_time_zone_radio, "active", SettingsBindFlags.DEFAULT);
         time_zone_settings.bind ("automatic-timezone", time_zone_picker, "sensitive", SettingsBindFlags.INVERT_BOOLEAN);
-- 
2.45.2

From 0be7fd8092fd00ba7196ec033070442ce2bf2478 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Sat, 10 Feb 2024 20:39:33 -0800
Subject: [PATCH 895/920] MainView: fix markup compiler warning (#121)

Co-authored-by: Vishal Rao <vishalrao@gmail.com>
---
 src/MainView.vala | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/MainView.vala b/src/MainView.vala
index 54099e6..773724e 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -136,7 +136,7 @@ public class DateTime.MainView : Switchboard.SettingsPage {
         var week_number_label = new Granite.HeaderLabel (_("Show Week Numbers")) {
             hexpand = true,
             mnemonic_widget = week_number_switch,
-            secondary_text = _("e.g. in Calendar and the Date & Time Panel indicator")
+            secondary_text = _("e.g. in Calendar and the Date &amp; Time Panel indicator")
         };
 
         var week_number_box = new Gtk.Box (Gtk.Orientation.HORIZONTAL, 12);
-- 
2.45.2

From 9236206d05303c621555bfdd6e4eee603876218e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Sun, 11 Feb 2024 04:52:48 -0800
Subject: [PATCH 899/920] MainView: use bind_with_mapping to set auto icon
 (#120)

* MainView: use bind_with_mapping to set auto icon

* More compact syntax

---------

Co-authored-by: Jeremy Wootten <jeremywootten@gmail.com>
---
 src/MainView.vala | 21 ++++++++-------------
 1 file changed, 8 insertions(+), 13 deletions(-)

diff --git a/src/MainView.vala b/src/MainView.vala
index 773724e..56129f9 100644
--- a/src/MainView.vala
+++ b/src/MainView.vala
@@ -18,7 +18,6 @@
  */
 
 public class DateTime.MainView : Switchboard.SettingsPage {
-    private Gtk.Image auto_time_zone_icon;
     private TimeZoneGrid time_zone_picker;
     private DateTime1 datetime1;
     private CurrentTimeManager ct_manager;
@@ -29,16 +28,6 @@ public class DateTime.MainView : Switchboard.SettingsPage {
 
     private static GLib.Settings time_zone_settings;
 
-    public bool automatic_timezone {
-        set {
-            if (value) {
-                auto_time_zone_icon.icon_name = "location-active-symbolic";
-            } else {
-                auto_time_zone_icon.icon_name = "location-inactive-symbolic";
-            }
-        }
-    }
-
     public MainView () {
         Object (
             icon: new ThemedIcon ("preferences-system-time"),
@@ -69,7 +58,7 @@ public class DateTime.MainView : Switchboard.SettingsPage {
 
         var time_zone_label = new Granite.HeaderLabel (_("Time Zone"));
 
-        auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic") {
+        var auto_time_zone_icon = new Gtk.Image.from_icon_name ("location-inactive-symbolic") {
             pixel_size = 24
         };
         auto_time_zone_icon.add_css_class (Granite.STYLE_CLASS_ACCENT);
@@ -287,7 +276,13 @@ public class DateTime.MainView : Switchboard.SettingsPage {
 
         time_zone_settings.bind ("automatic-timezone", auto_time_zone_radio, "active", SettingsBindFlags.DEFAULT);
         time_zone_settings.bind ("automatic-timezone", time_zone_picker, "sensitive", SettingsBindFlags.INVERT_BOOLEAN);
-        time_zone_settings.bind ("automatic-timezone", this, "automatic-timezone", SettingsBindFlags.GET);
+
+        time_zone_settings.bind_with_mapping ("automatic-timezone", auto_time_zone_icon, "icon-name", GET,
+            (value, variant, user_data) => {
+                value.set_string (variant.get_boolean () ? "location-active-symbolic" : "location-inactive-symbolic");
+                return true;
+            }, () => { return true; }, null, null
+        );
     }
 
     private async void setup_time_format () {
-- 
2.45.2

From 13ed638a6c6c4f72e8804ff8afaea2189598cb26 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Danielle=20For=C3=A9?= <danielle@elementary.io>
Date: Thu, 21 Mar 2024 09:34:57 -0700
Subject: [PATCH 910/920] Handle own titlebuttons (#122)

---
 src/Plug.vala | 19 +++++++++++++++----
 1 file changed, 15 insertions(+), 4 deletions(-)

diff --git a/src/Plug.vala b/src/Plug.vala
index 07ddb38..4c8ace8 100644
--- a/src/Plug.vala
+++ b/src/Plug.vala
@@ -18,7 +18,7 @@
  */
 
 public class DateTime.Plug : Switchboard.Plug {
-    private MainView main_view;
+    private Gtk.Box box;
 
     public Plug () {
         GLib.Intl.bindtextdomain (GETTEXT_PACKAGE, LOCALEDIR);
@@ -36,11 +36,22 @@ public class DateTime.Plug : Switchboard.Plug {
     }
 
     public override Gtk.Widget get_widget () {
-        if (main_view == null) {
-            main_view = new DateTime.MainView ();
+        if (box == null) {
+            var headerbar = new Adw.HeaderBar () {
+                show_title = false
+            };
+            headerbar.add_css_class (Granite.STYLE_CLASS_FLAT);
+
+            var main_view = new MainView () {
+                vexpand = true
+            };
+
+            box = new Gtk.Box (VERTICAL, 0);
+            box.append (headerbar);
+            box.append (main_view);
         }
 
-        return main_view;
+        return box;
     }
 
     public override void shown () {
-- 
2.45.2

