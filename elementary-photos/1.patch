From 075f983a65e9c6d4e80ee07f0c05309badef526a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Corentin=20No=C3=ABl?= <corentin.noel@collabora.com>
Date: Mon, 21 Aug 2023 14:45:44 +0200
Subject: [PATCH] Remove the publishing dependencies

---
 .github/workflows/ci.yml |  2 +-
 README.md                |  7 -------
 docs/meson.build         |  4 ----
 io.elementary.photos.yml | 11 ++---------
 meson.build              | 10 ----------
 5 files changed, 3 insertions(+), 31 deletions(-)
diff --git a/README.md b/README.md
index 54bb82c8d..793e8896a 100644
--- a/README.md
+++ b/README.md
@@ -9,7 +9,6 @@
 You'll need the following dependencies:
 * desktop-file-utils
 * intltool
-* libaccounts-glib-dev
 * libexif-dev
 * libgee-0.8-dev
 * libgeocode-glib-dev
@@ -22,15 +21,9 @@ You'll need the following dependencies:
 * libgtk-3-dev
 * libgudev-1.0-dev
 * libhandy-1-dev
-* libjson-glib-dev
 * libraw-dev
-* librest-dev
-* libsignon-glib-dev
-* libsoup2.4-dev
 * libsqlite3-dev
-* libwebkit2gtk-4.0-dev
 * libwebp-dev
-* libxml2
 * meson
 * valac >= 0.40
 
diff --git a/io.elementary.photos.yml b/io.elementary.photos.yml
index f408f1d5f..787a2b471 100644
--- a/io.elementary.photos.yml
+++ b/io.elementary.photos.yml
@@ -39,10 +39,11 @@ modules:
     config-opts:
       - '-Denable-installed-tests=false'
       - '-Denable-gtk-doc=false'
+      - '-Dsoup2=false'
     sources:
       - type: git
         url: https://gitlab.gnome.org/GNOME/geocode-glib.git
-        tag: '3.26.2'
+        tag: '3.26.4'
 
   - name: gexiv2
     buildsystem: meson
@@ -101,14 +102,6 @@ modules:
           - 'autoreconf -vfi'
         dest-filename: autogen.sh
 
-  - name: rest
-    config-opts:
-      - '--disable-gtk-doc'
-    sources:
-      - type: git
-        url: https://gitlab.gnome.org/GNOME/librest.git
-        tag: '0.8.1'
-
   - name: photos
     buildsystem: meson
     sources:
diff --git a/meson.build b/meson.build
index b0c28d92c..9b8377cfe 100644
--- a/meson.build
+++ b/meson.build
@@ -59,16 +59,11 @@ granite_dep = dependency('granite', version: '>=6.0.0')
 gtk_dep = dependency('gtk+-3.0', version: '>=3.6.0')
 gudev_dep = dependency('gudev-1.0', version: '>=145')
 handy = dependency('libhandy-1')
-json_glib_dep = dependency('json-glib-1.0')
 libexif_dep = dependency('libexif', version: '>=0.6.16')
 gphoto2_dep = dependency('libgphoto2', version: '>=2.4.2')
 libraw_dep = dependency('libraw', version: '>=0.13.2')
 libwebp_dep = dependency('libwebp', version: '>=0.4.4')
-libsoup_dep = dependency('libsoup-2.4', version: '>=2.26.0')
-libxml_dep = dependency('libxml-2.0', version: '>=2.6.32')
-rest_dep = dependency('rest-0.7', version: '>=0.7')
 sqlite3_dep = dependency('sqlite3', version: '>=3.5.9')
-webkit2gtk_dep = dependency('webkit2gtk-4.0', version: '>=2.0.0')
 gstreamer_plugins_base_vapi = meson.get_compiler('vala').find_library('gstreamer-base-1.0')
 gstreamer_plugins_base_dep = declare_dependency(dependencies: [gstreamer_plugins_base_vapi])
 lconv_dep = meson.get_compiler('vala').find_library('LConv', dirs: join_paths(meson.current_source_dir(), 'vapi'))
@@ -91,16 +86,11 @@ dependencies = [
     gtk_dep,
     gudev_dep,
     handy,
-    json_glib_dep,
     libexif_dep,
     gphoto2_dep,
     libraw_dep,
     libwebp_dep,
-    libsoup_dep,
-    libxml_dep,
-    rest_dep,
     sqlite3_dep,
-    webkit2gtk_dep,
     lconv_dep,
     linux_dep,
 ]

From ea11cf23db6945df6cc3495fd698456054389371 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Corentin=20No=C3=ABl?= <corentin.noel@collabora.com>
Date: Mon, 21 Aug 2023 14:59:29 +0200
Subject: [PATCH] meson: Allow to use geocode-glib-2.0

This is required since the libsoup API bump.
---
 docs/meson.build | 2 +-
 meson.build      | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/docs/meson.build b/docs/meson.build
index aa70a7aa7..5c5b6a528 100644
--- a/docs/meson.build
+++ b/docs/meson.build
@@ -7,7 +7,7 @@ basic_command = [
     '--package-name',meson.project_name(),
     '--package-version', meson.project_version(),
     '--driver', meson.get_compiler('vala').version(),
-    '--pkg', 'geocode-glib-1.0',
+    '--pkg', geocode_glib_dep.name(),
     '--pkg', 'gexiv2',
     '--pkg', 'gtk+-3.0',
     '--pkg', 'gee-0.8',
diff --git a/meson.build b/meson.build
index 9b8377cfe..ea72b8881 100644
--- a/meson.build
+++ b/meson.build
@@ -49,7 +49,7 @@ gexiv2_dep = dependency('gexiv2', version: '>=0.4.90')
 if gexiv2_dep.version().version_compare('>= 0.11')
   add_global_arguments(['--define=GEXIV2_0_11'], language : 'vala')
 endif
-geocode_glib_dep = dependency('geocode-glib-1.0')
+geocode_glib_dep = dependency('geocode-glib-2.0', 'geocode-glib-1.0')
 gmodule_dep = dependency('gmodule-2.0', version: '>=2.24.0')
 gstreamer_dep = dependency('gstreamer-1.0', version: '>=1.0.0')
 gstreamer_base_dep = dependency('gstreamer-base-1.0', version: '>=1.0.0')
